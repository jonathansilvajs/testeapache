services:
  web:
    build: .
    container_name: php-apache-web
    ports:
      - "8080:80"
    environment:
      # Git (clonado uma vez)
      GIT_REPO: ${GIT_REPO}
      GIT_REF: ${GIT_REF:-main}
      GIT_USER: ${GIT_USER:-}
      GIT_TOKEN: ${GIT_TOKEN:-}

      # DB (criada/duplicada ANTES do clone)
      DB_HOST: ${DB_HOST}
      DB_PORT: ${DB_PORT:-3306}
      DB_NAME: ${DB_NAME}
      DB_USER: ${DB_USER}
      DB_PASS: ${DB_PASS}
      SOURCE_DB: ${SOURCE_DB:-}        # << opcional, ex.: somniacrm
      RUN_INIT_DB: ${RUN_INIT_DB:-true}
      FORCE_DB_INIT: ${FORCE_DB_INIT:-false}
      WAIT_FOR_DB: ${WAIT_FOR_DB:-true}
      DB_WAIT_MAX: ${DB_WAIT_MAX:-60}

      TZ: ${TZ:-Europe/Lisbon}
    restart: unless-stopped
